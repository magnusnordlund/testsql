# Custom key bindings in SSMS
During my years as a Data Engineer, I've come across multiple instances of different ways to increase work performance and get easy access. If you have never heard of Custom Key Bindings, you are missing out! Here are a few tips of easy-to-use keybindings to increase your workflow in SQL Server Management Studio (SSMS)! 
Custom key bindings can be a game-changer! By assigning specific commands to shortcuts that align with your workflow, you can boost productivity and efficiency in your daily tasks. The power of custom keybindings in optimizing my daily work process, helps quite a bit when increasing work performance. By assigning commonly used functions to personalized shortcuts, I’ve transformed the way I interact with the tool, saving valuable time and reducing repetitive actions.
A thing to note on how key bindings work is that if you highlight something within your editor, it will show as the latest part of the command. This has a few drawbacks and setbacks as you cannot simply script as easily as you'd like. But you can place commands in here without needing any highlight if you have common queries that you use daily. Here’s how to do it in SSMS: Go into Tools > Options, then go to Environment > Keyboard > Query Shortcuts (note that some are defined by SSMS and cannot be changed).
 
Here are a few examples of custom key bindings that have revolutionized my SSMS experience:


## Each Keybind with description:
 

### Keybinding: Alt + F1 - System defined.
Description: Commonly used to view creation and how tables / views etc. are setup.
Function: Executes the highlighted query with a table description about how it is created and all it's components:
Steps: Highight a table + schema or table depending on setup and press Alt + F1
Code:
```
 sp_help
```
<Image>
 
### Keybinding: Ctrl + F1 
Description: Opens up a text based functionality of the build setup for tables / schema / views / procedures etc. Can also view system based objects.
Function: The fuctionality is based like a procedure and prints it out in text format in the messages window.
Steps: Highlight any table / view / schema / function etc. and press Ctrl + F1 within the system and it will give you a quick view of it's buildup.
Code:
``` 
sp_helptext
```
<Image>
 
### Keybinding: Ctrl + 1 - System locked.
Description: Check who is online, when the latest action was etc. I personally prefer sp_who2, but each to their own.
Function: Can check if a session id is being blocked, from which hostname and what the session is currently doing.
Steps: Simply press Ctrl + 1 anywhere.
Code:
```
 sp_who
```
<Image>
 
### Keybinding: Ctrl + 2 - System defined.
Description: Check for locks in the system, don't personally use this one that much tbh. Others probably have more opinions than me on this one.
Function: Shows the session id, which database is currently in focus, which objectid is occupied etc.
Steps: Simply press Ctrl + 2 anywhere.
Code:
```
 sp_lock
```
<Image>
 
### Keybinding: Ctrl + 3
Description: SELECT function, can be used to quickly check data within a table / function / view or temporary table while having WITH(NOLOCK) and TABLESAMPLE functionality, can also find all tables within schemas.
Function: Executes the highlighted query with a simple SELECT using (NOLOCK) and TABLESAMPLE. This is commonly used for fast access to data without interfering with any critical system queries while getting as much info about the data as possible.
Steps: Highight a table or schema and press Ctrl + 3, highlighting a table / view or temporary table will show you the data, highlighting a schema, will provide you with each table name within the schema. You can also encapsulate the highlighted query with two Apostrophe signs ( ' ) to execute the query for a certain schema if you are using the same name standard between schemas.
Code:
```
 EXEC sp_executesql N'DECLARE @schema sysname, @table sysname, @SQLQUERY nvarchar(500); DECLARE @TABLE_SAMPLE NVARCHAR(100) = ''TABLESAMPLE(20)'' IF (CHARINDEX(CHAR(46), @objname) > 0) BEGIN SET @schema = SUBSTRING(@objname, 0, CHARINDEX(CHAR(46), @objname)) SET @table  = SUBSTRING(@objname, CHARINDEX(CHAR(46), @objname) + 1, SUM(LEN(@objname) - (CHARINDEX(CHAR(46), @objname)))); END ELSE BEGIN SET @table = @objname; SET @schema = (SELECT TOP 1 TABLE_SCHEMA FROM INFORMATION_SCHEMA.TABLES T WHERE T.TABLE_NAME = @table AND TABLE_TYPE = ''BASE TABLE'' UNION SELECT TOP 1 TABLE_SCHEMA FROM INFORMATION_SCHEMA.VIEWS T WHERE T.TABLE_NAME = @table) IF (@schema IS NULL AND @table NOT LIKE ''#%'') BEGIN SET @schema = @objname; SET @table = NULL; END END SET @SQLQUERY = ''SELECT TOP(1000) * FROM '' IF (@schema IS NOT NULL AND @table IS NULL) BEGIN SET @SQLQUERY = @SQLQUERY + ''INFORMATION_SCHEMA.TABLES T WHERE T.TABLE_SCHEMA = '''''' + @schema + '''''' AND TABLE_TYPE = ''''BASE TABLE'''';'' END ELSE IF (@schema IS NOT NULL) BEGIN SET @SQLQUERY = @SQLQUERY + ''['' + @schema + ''].'' END IF (@table IS NOT NULL) BEGIN IF (SELECT TOP(1) 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @table AND TABLE_TYPE = ''BASE TABLE'' ) = 1 BEGIN SET @SQLQUERY = @SQLQUERY + ''['' + @table + ''] '' + @TABLE_SAMPLE + '' WITH(NOLOCK);'' END ELSE BEGIN SET @SQLQUERY = @SQLQUERY + ''['' + @table + ''] '' + '' WITH(NOLOCK);'' END END EXEC sp_executesql @SQLQUERY ', N'@objname nvarchar(776)', @objname = 
 ```
<Image>
 
Keybinding: Ctrl + 4
Description: Basic SELECT functionality. Most commonly used to do quick selects without nolock and table sample, can easier be used in the middle of queries with an easier functionality when comes to extra joins / where cases etc. as this functionality is not locked by anymore information coming the downfalls of having the information sent to the shortcut being altered or handled.
Function: Can easily outshine the shortcut used above if no(lock) and tablesample is not needed, easier access to query availability and can query Selections with both joins and where within it's highlight, really nice to have.
Steps: Highlight a parts of a query or simply the table and click Ctrl + 4.
Code:
```
 SELECT TOP(1000) * FROM 
 ```
<Image>
 
•	Keybinding: Ctrl + 5
Description: Count function, used to get a count with format on single table, if used on a schema, it will collect the stored amount of rows from each table within the schema aswell as size usage.
Function: Count usage, can be used to quickly count rows from tables etc. using format and (WITH(NOLOCK)) functionality, this is ofcourse something to be discussed if this is wanted or not, but I prefer it.
Steps: Highight a table or schema and press Ctrl + 5, highlighting a table / view or temporary table will show you the amount of rows along with which schema / table. if used on a schema it will check the stored amount of rows along with SizeInMB
Code:
```
 EXEC sp_executesql N'DECLARE @schema sysname, @table sysname, @SQLQUERY nvarchar(MAX); IF (CHARINDEX(CHAR(46), @objname) > 0) BEGIN	SET @schema = SUBSTRING(@objname, 0, CHARINDEX(CHAR(46), @objname)) SET @table  = SUBSTRING(@objname, CHARINDEX(CHAR(46), @objname) + 1, SUM(LEN(@objname) - (CHARINDEX(CHAR(46), @objname)))) END ELSE	BEGIN SET @table = @objname; SET @schema = (SELECT TOP 1 TABLE_SCHEMA FROM INFORMATION_SCHEMA.TABLES T WHERE T.TABLE_NAME = @table AND TABLE_TYPE = ''BASE TABLE'' UNION SELECT TOP 1 TABLE_SCHEMA FROM INFORMATION_SCHEMA.VIEWS T WHERE T.TABLE_NAME = @table) IF (@schema IS NULL AND @table NOT LIKE ''#%'') BEGIN  SET @schema = @objname; SET @table = NULL; END END SET @SQLQUERY = ''SELECT '''''' + ISNULL(@schema, ''tmpDb'') + '''''' As SchemaName, '''''' + @table + '''''' As TableName, RecordCount = FORMAT(COUNT(*), ''''N0'''') FROM '' IF (@schema IS NOT NULL AND @table IS NULL) BEGIN SET @SQLQUERY = N''INSERT INTO ##Statistics (SchemaName, TableName, RecordCount, SpaceUsed) SELECT '''''' + @schema + '''''' As SchemaName, REPLACE(REPLACE(REPLACE(''''?'''', '''']'''', ''''''''), ''''['''', ''''''''), '''''' + @schema + ''.'''' , '''''''') As TableName, FORMAT(SUM(st.row_count), ''''N0'''') As RecordCount, T.SizeMB FROM sys.dm_db_partition_stats st JOIN ( SELECT p.object_id TableID, sum(a.total_pages)  8192 / 10240000.0 AS SizeMB FROM sys.partitions p INNER JOIN sys.allocation_units a on p.partition_id = a.container_id GROUP BY p.object_id ) T ON st.object_id = T.TableID WHERE object_name(object_id) = REPLACE(REPLACE(REPLACE(''''?'''', '''']'''', ''''''''), ''''['''', ''''''''), '''''' + @schema + ''.'''' , '''''''') AND (index_id < 2) group by T.SizeMB'' END ELSE IF (@schema IS NOT NULL) BEGIN SET @SQLQUERY = @SQLQUERY + ''['' + @schema + ''].'' END IF (@table IS NOT NULL) BEGIN SET @SQLQUERY = @SQLQUERY + ''['' + @table + '']'' + '' WITH(NOLOCK);'' END IF @table IS NOT NULL BEGIN EXEC sp_executesql @SQLQUERY END ELSE BEGIN DECLARE @PRE_COMMAND NVARCHAR(500) = ''IF OBJECT_ID(''''tempdb..##Statistics'''') IS NOT NULL DROP TABLE ##Statistics; CREATE TABLE ##Statistics (SchemaName varchar(128) NOT NULL, TableName varchar(128) NOT NULL, RecordCount NVARCHAR(200),	SpaceUsed FLOAT)'' DECLARE @COMMAND2 NVARCHAR(1000) =''UPDATE S SET s.SpaceUsed = g.SizeMB FROM ##Statistics s INNER JOIN (SELECT p.object_id TableID, sum(a.total_pages)  8192 / 1024.0 AS SizeMB FROM sys.partitions p INNER JOIN sys.allocation_units a on p.partition_id = a.container_id GROUP BY p.object_id) g ON OBJECT_ID(s.TableName) = g.TableID	WHERE s.TableName = ''''?'''''' DECLARE @POST_COMMAND NVARCHAR(1000) = N''SELECT SchemaName, TableName, RecordCount, SpaceUsed FROM ##Statistics ORDER BY SpaceUsed DESC, RecordCount DESC;	IF OBJECT_ID(''''tempdb..##Statistics'''') IS NOT NULL DROP TABLE ##Statistics;'' DECLARE @WHEREAND NVARCHAR(500) = N''AND schema_name(schema_id) = '''''' + @schema + '''''''' EXEC sp_MSforeachtable @precommand = @PRE_COMMAND, @command1 = @SQLQUERY, @command2 = @COMMAND2, @postcommand = @POST_COMMAND, @whereand = @WHEREAND END', N'@objname nvarchar(776)', @objname = 
 ```
<Image>
 
•	Keybinding: Ctrl + 6
Description: The ability to find all references to based upon the highlighted need. Along with easy access to open said highlight to check information that is needed.
Function: Can look through all objects in the database for similar name structures, does not search in tables however. But otherwise goes through everything.
Steps: Highlight anything, anywhere. Click Ctrl + 6 and the script will search through everything based on the database for names similar or using the highlighted text.
Code:
```
 EXEC sp_executesql N'BEGIN SET ARITHABORT ON; SET QUOTED_IDENTIFIER ON; SET ANSI_PADDING ON; DECLARE @DB_NAME NVARCHAR(200), @SCHEMA NVARCHAR(200) = ''''; SET @DB_NAME = DB_NAME() IF LEN(@objname) - LEN(REPLACE(@objname, ''['', '''')) > 0 BEGIN SET @objname = REPLACE(REPLACE(@objname, ''['', ''''), '']'', '''') END IF LEN(@objname) - LEN(REPLACE(@objname, ''.'', '''')) > 0 BEGIN SET @SCHEMA = SUBSTRING(@objname,0,CHARINDEX(''.'', @objname, 0)) SET @objname = SUBSTRING(@objname,CHARINDEX(''.'', @objname, 0) + 1, LEN(@objname) - CHARINDEX(''.'', @objname, 0)) END ELSE BEGIN SET @SCHEMA = ''dbo'' END DECLARE @StrNorm NVARCHAR(MAX) = '''' SET @StrNorm = @objname; SET @objname = '' + '''''''''' + @objname + '''''''''' + '' DECLARE @SQL NVARCHAR(MAX) = '''' IF OBJECT_ID(''tempdb..##TMP_LOAD'') IS NOT NULL DROP TABLE ##TMP_LOAD; BEGIN TRY EXEC(''USE ['' + @DB_NAME + ''] EXEC('''' CREATE TABLE ##TMP_LOAD ([Type] NVARCHAR(100), [Name] NVARCHAR(200), [Definition] NVARCHAR(MAX)); INSERT INTO ##TMP_LOAD SELECT [Type], [Name], [Definition] FROM ( SELECT ''''''''Stored Procedure'''''''' As [Type], CAST(''''''''['''''''' + T1.name + ''''''''].['''''''' + OBJECT_NAME(T.OBJECT_ID) + '''''''']'''''''' AS NVARCHAR(200)) As [Name], OBJECT_DEFINITION(T.OBJECT_ID) As [Definition] FROM sys.procedures T WITH (NOWAIT) JOIN sys.schemas T1 WITH (NOWAIT) ON T1.schema_id = T.schema_id WHERE OBJECT_DEFINITION(T.OBJECT_ID) LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''' UNION ALL SELECT ''''''''View'''''''' As [Type], CAST(''''''''['''''''' + T1.name + ''''''''].['''''''' + OBJECT_NAME(T.OBJECT_ID) + '''''''']'''''''' AS NVARCHAR(200)) As [Name], OBJECT_DEFINITION(T.OBJECT_ID) As [Definition] FROM sys.views T WITH (NOWAIT) JOIN sys.schemas T1 WITH (NOWAIT) ON T1.schema_id = T.schema_id WHERE OBJECT_DEFINITION(T.OBJECT_ID) LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''' UNION ALL SELECT ''''''''Function'''''''' As [Type], ''''''''['''''''' + T.SPECIFIC_SCHEMA + ''''''''].['''''''' + T.ROUTINE_NAME + '''''''']'''''''' As [Name], T.ROUTINE_DEFINITION As [Definition] FROM INFORMATION_SCHEMA.ROUTINES T WITH (NOWAIT) WHERE T.ROUTINE_DEFINITION LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''' AND T.ROUTINE_TYPE = ''''''''FUNCTION'''''''' UNION ALL SELECT [Type], [Name], [Definition] FROM (SELECT ''''''''User Defined Type'''''''' As [Type], ''''''''['''''''' + s1.name + ''''''''].['''''''' + Type1.name + '''''''']'''''''' As [Name], ''''''''CREATE TABLE ['''''''' + s1.name + ''''''''].['''''''' + Type1.name + ''''''''] ('''''''' + CHAR(13) + CHAR(13) + (SELECT ISNULL(STUFF(( SELECT CHAR(9) + '''''''', '''''''' + ISNULL([COLUMNNAME], '''''''''''''''') + '''''''' '''''''' + ISNULL(UPPER([Data Type]), '''''''''''''''') + CASE WHEN LOWER(ISNULL([Data Type], '''''''''''''''')) like ''''''''%char%'''''''' THEN ''''''''('''''''' + CAST(ISNULL([Length], '''''''''''''''') AS NVARCHAR(20)) + '''''''')'''''''' ELSE '''''''''''''''' END + '''''''' '''''''' + ISNULL([Nullable], '''''''''''''''') + '''''''' '''''''' + ISNULL([Collation], '''''''''''''''') + CHAR(13) As [Columns] FROM ( SELECT USER_NAME(TYPE.schema_id) + ''''''''.'''''''' + TYPE.name AS "Type Name", Type.Name As M_Type, COL.column_id, SUBSTRING(CAST(COL.column_id + 100 AS char(3)), 2, 2) + '''''''': '''''''' + COL.name AS "Column", COL.name AS "ColumnName", ST.name AS "Data Type", CASE COL.Is_Nullable WHEN 1 THEN ''''''''NULL'''''''' ELSE ''''''''NOT NULL'''''''' END AS "Nullable", COL.max_length AS "Length", COL.[precision] AS "Precision", COL.scale AS "Scale", ST.collation AS "Collation" FROM sys.table_types TYPE JOIN sys.columns COL ON TYPE.type_table_object_id = COL.object_id JOIN sys.systypes AS ST ON ST.xtype = COL.system_type_id WHERE TYPE.is_user_defined = 1) T WHERE LOWER(T.M_Type) = LOWER(type1.name) ORDER BY "Type Name", column_id FOR XML PATH(''''''''''''''''), TYPE).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, CHAR(9) + '''''''' ''''''''), '''''''''''''''') As ColumnTypes) + char(13) + '''''''')'''''''' As [Definition] FROM sys.table_types Type1 WITH (NOWAIT) JOIN sys.schemas s1 WITH (NOWAIT) ON Type1.schema_id = s1.schema_id WHERE Type1.name LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''') TUQ UNION ALL SELECT [Type], [Name], [Definition] FROM (SELECT ''''''''Table Column'''''''' As [Type] , CAST(''''''''['''''''' + T1.name + ''''''''].['''''''' + T.name + '''''''']'''''''' AS NVARCHAR(200)) As [Name] , Q.COLUMN_DEF As [Definition] FROM sys.tables t WITH (NOWAIT) JOIN sys.schemas T1 WITH (NOWAIT) ON T1.schema_id = T.schema_id JOIN sys.columns c WITH (NOWAIT) ON t.OBJECT_ID = c.OBJECT_ID JOIN ( SELECT c.OBJECT_ID As OBJECT_ID , c.Name As ColumnName , ''''''''['''''''' + UPPER(c.name) + ''''''''] '''''''' + CASE WHEN c.is_computed = 1 THEN ''''''''AS '''''''' + cc.[definition] ELSE UPPER(tp.name) + CASE WHEN tp.name IN (''''''''varchar'''''''', ''''''''char'''''''', ''''''''varbinary'''''''', ''''''''binary'''''''', ''''''''text'''''''') THEN ''''''''('''''''' + CASE WHEN c.max_length = -1 THEN ''''''''MAX'''''''' ELSE CAST(c.max_length AS VARCHAR(5)) END + '''''''')'''''''' WHEN tp.name IN (''''''''nvarchar'''''''', ''''''''nchar'''''''', ''''''''ntext'''''''') THEN ''''''''('''''''' + CASE WHEN c.max_length = -1 THEN ''''''''MAX'''''''' ELSE CAST(c.max_length / 2 AS VARCHAR(5)) END + '''''''')'''''''' WHEN tp.name IN (''''''''datetime2'''''''', ''''''''time2'''''''', ''''''''datetimeoffset'''''''') THEN ''''''''('''''''' + CAST(c.scale AS VARCHAR(5)) + '''''''')'''''''' WHEN tp.name = ''''''''decimal'''''''' THEN ''''''''('''''''' + CAST(c.[precision] AS VARCHAR(5)) + '''''''','''''''' + CAST(c.scale AS VARCHAR(5)) + '''''''')'''''''' ELSE '''''''''''''''' END + CASE WHEN c.collation_name IS NOT NULL THEN '''''''' COLLATE '''''''' + c.collation_name ELSE '''''''''''''''' END + CASE WHEN c.is_nullable = 1 THEN '''''''' NULL'''''''' ELSE '''''''' NOT NULL'''''''' END + CASE WHEN dc.[definition] IS NOT NULL THEN '''''''' DEFAULT'''''''' + dc.[definition] ELSE '''''''''''''''' END + CASE WHEN ic.is_identity = 1 THEN '''''''' IDENTITY('''''''' + CAST(ISNULL(ic.seed_value, ''''''''0'''''''') AS CHAR(1)) + '''''''','''''''' + CAST(ISNULL(ic.increment_value, ''''''''1'''''''') AS CHAR(1)) + '''''''')'''''''' ELSE '''''''''''''''' END END As COLUMN_DEF FROM sys.columns c WITH (NOWAIT) JOIN sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id LEFT JOIN sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id LEFT JOIN sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id LEFT JOIN sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id ) Q ON Q.OBJECT_ID = t.OBJECT_ID AND c.name = Q.ColumnName WHERE c.name LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''' ) TUQ UNION ALL SELECT [Type] , [Name] , [Definition] FROM ( SELECT ''''''''Table'''''''' As [Type] , CAST(''''''''['''''''' + T1.name + ''''''''].['''''''' + Tt.name + '''''''']'''''''' AS NVARCHAR(200)) As [Name] , Q.SQL_DEF As [Definition] FROM sys.tables tt WITH (NOWAIT) JOIN sys.schemas T1 WITH (NOWAIT) ON T1.schema_id = Tt.schema_id JOIN ( SELECT tq.name As TableName , ''''''''CREATE TABLE '''''''' + tq.name + CHAR(13) + ''''''''('''''''' + CHAR(13) + STUFF ( ( SELECT CHAR(9) + '''''''', ['''''''' + c.name + ''''''''] '''''''' + CASE WHEN c.is_computed = 1 THEN ''''''''AS '''''''' + cc.[definition] ELSE UPPER(tp.name) + CASE WHEN tp.name IN (''''''''varchar'''''''', ''''''''char'''''''', ''''''''varbinary'''''''', ''''''''binary'''''''', ''''''''text'''''''') THEN ''''''''('''''''' + CASE WHEN c.max_length = -1 THEN ''''''''MAX'''''''' ELSE CAST(c.max_length AS VARCHAR(5)) END + '''''''')'''''''' WHEN tp.name IN (''''''''nvarchar'''''''', ''''''''nchar'''''''', ''''''''ntext'''''''') THEN ''''''''('''''''' + CASE WHEN c.max_length = -1 THEN ''''''''MAX'''''''' ELSE CAST(c.max_length / 2 AS VARCHAR(5)) END + '''''''')'''''''' WHEN tp.name IN (''''''''datetime2'''''''', ''''''''time2'''''''', ''''''''datetimeoffset'''''''') THEN ''''''''('''''''' + CAST(c.scale AS VARCHAR(5)) + '''''''')'''''''' WHEN tp.name = ''''''''decimal'''''''' THEN ''''''''('''''''' + CAST(c.[precision] AS VARCHAR(5)) + '''''''','''''''' + CAST(c.scale AS VARCHAR(5)) + '''''''')'''''''' ELSE '''''''''''''''' END + CASE WHEN c.collation_name IS NOT NULL THEN '''''''' COLLATE '''''''' + c.collation_name ELSE '''''''''''''''' END + CASE WHEN c.is_nullable = 1 THEN '''''''' NULL'''''''' ELSE '''''''' NOT NULL'''''''' END + CASE WHEN dc.[definition] IS NOT NULL THEN '''''''' DEFAULT'''''''' + dc.[definition] ELSE '''''''''''''''' END + CASE WHEN ic.is_identity = 1 THEN '''''''' IDENTITY('''''''' + CAST(ISNULL(ic.seed_value, ''''''''0'''''''') AS CHAR(1)) + '''''''','''''''' + CAST(ISNULL(ic.increment_value, ''''''''1'''''''') AS CHAR(1)) + '''''''')'''''''' ELSE '''''''''''''''' END END + CHAR(13) FROM sys.columns c WITH (NOWAIT) JOIN sys.types tp WITH (NOWAIT) ON c.user_type_id = tp.user_type_id LEFT JOIN sys.computed_columns cc WITH (NOWAIT) ON c.[object_id] = cc.[object_id] AND c.column_id = cc.column_id LEFT JOIN sys.default_constraints dc WITH (NOWAIT) ON c.default_object_id != 0 AND c.[object_id] = dc.parent_object_id AND c.column_id = dc.parent_column_id LEFT JOIN sys.identity_columns ic WITH (NOWAIT) ON c.is_identity = 1 AND c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id WHERE c.[object_id] = tq.object_id ORDER BY c.column_id FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, CHAR(9) + '''''''' '''''''' ) + ISNULL( ( SELECT CHAR(9) + '''''''', CONSTRAINT ['''''''' + k.name + ''''''''] PRIMARY KEY ('''''''' + ( SELECT STUFF( ( SELECT '''''''', ['''''''' + c.name + ''''''''] '''''''' + CASE WHEN ic.is_descending_key = 1 THEN ''''''''DESC'''''''' ELSE ''''''''ASC'''''''' END FROM sys.index_columns ic WITH (NOWAIT) JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = ic.[object_id] AND c.column_id = ic.column_id WHERE ic.is_included_column = 0 AND ic.[object_id] = k.parent_object_id AND ic.index_id = k.unique_index_id FOR XML PATH(N''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, '''''''''''''''' ) ) + '''''''')'''''''' + CHAR(13) FROM sys.key_constraints k WITH (NOWAIT) WHERE k.parent_object_id = tq.object_id AND k.[type] = ''''''''PK'''''''' ) , '''''''''''''''') + '''''''')'''''''' + CHAR(13) + ISNULL( ( SELECT ( SELECT CHAR(13) + ''''''''ALTER TABLE '''''''' + tq.name + '''''''' WITH'''''''' + CASE WHEN fk.is_not_trusted = 1 THEN '''''''' NOCHECK'''''''' ELSE '''''''' CHECK'''''''' END + '''''''' ADD CONSTRAINT ['''''''' + fk.name + ''''''''] FOREIGN KEY('''''''' + STUFF( ( SELECT '''''''', ['''''''' + k.cname + '''''''']'''''''' FROM ( SELECT k.constraint_object_id ,cname = c.name ,rcname = rc.name FROM sys.foreign_key_columns k WITH (NOWAIT) JOIN sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id WHERE k.parent_object_id = tq.object_id ) k WHERE k.constraint_object_id = fk.[object_id] FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, '''''''''''''''') + '''''''')'''''''' + '''''''' REFERENCES ['''''''' + SCHEMA_NAME(ro.[schema_id]) + ''''''''].['''''''' + ro.name + ''''''''] ('''''''' + STUFF( ( SELECT '''''''', ['''''''' + k.rcname + '''''''']'''''''' FROM ( SELECT k.constraint_object_id , cname = c.name , rcname = rc.name FROM sys.foreign_key_columns k WITH (NOWAIT) JOIN sys.columns rc WITH (NOWAIT) ON rc.[object_id] = k.referenced_object_id AND rc.column_id = k.referenced_column_id JOIN sys.columns c WITH (NOWAIT) ON c.[object_id] = k.parent_object_id AND c.column_id = k.parent_column_id WHERE k.parent_object_id = tq.object_id ) k WHERE k.constraint_object_id = fk.[object_id] FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, '''''''''''''''') + '''''''')'''''''' + CASE WHEN fk.delete_referential_action = 1 THEN '''''''' ON DELETE CASCADE'''''''' WHEN fk.delete_referential_action = 2 THEN '''''''' ON DELETE SET NULL'''''''' WHEN fk.delete_referential_action = 3 THEN '''''''' ON DELETE SET DEFAULT'''''''' ELSE '''''''''''''''' END + CASE WHEN fk.update_referential_action = 1 THEN '''''''' ON UPDATE CASCADE'''''''' WHEN fk.update_referential_action = 2 THEN '''''''' ON UPDATE SET NULL'''''''' WHEN fk.update_referential_action = 3 THEN '''''''' ON UPDATE SET DEFAULT'''''''' ELSE '''''''''''''''' END + CHAR(13) + ''''''''ALTER TABLE '''''''' + tq.name + '''''''' CHECK CONSTRAINT ['''''''' + fk.name + '''''''']'''''''' + CHAR(13) FROM sys.foreign_keys fk WITH (NOWAIT) JOIN sys.objects ro WITH (NOWAIT) ON ro.[object_id] = fk.referenced_object_id WHERE fk.parent_object_id = tq.object_id FOR XML PATH(N''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)'''''''') ), '''''''''''''''') + ISNULL( ( ( SELECT CHAR(13) + ''''''''CREATE'''''''' + CASE WHEN i.is_unique = 1 THEN '''''''' UNIQUE'''''''' ELSE '''''''''''''''' END + '''''''' NONCLUSTERED INDEX ['''''''' + i.name + ''''''''] ON '''''''' + tq.name + '''''''' ('''''''' + STUFF( ( SELECT '''''''', ['''''''' + c.name + '''''''']'''''''' + CASE WHEN c.is_descending_key = 1 THEN '''''''' DESC'''''''' ELSE '''''''' ASC'''''''' END FROM ( SELECT ic.[object_id] ,ic.index_id ,ic.is_descending_key ,ic.is_included_column ,c.name FROM sys.index_columns ic WITH (NOWAIT) JOIN sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id WHERE ic.[object_id] = tq.object_id ) c WHERE c.is_included_column = 0 AND c.index_id = i.index_id FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, '''''''''''''''' ) + '''''''')'''''''' + ISNULL(CHAR(13) + ''''''''INCLUDE ('''''''' + STUFF( ( SELECT '''''''', ['''''''' + c.name + '''''''']'''''''' FROM ( SELECT ic.[object_id] ,ic.index_id ,ic.is_descending_key ,ic.is_included_column ,c.name FROM sys.index_columns ic WITH (NOWAIT) JOIN sys.columns c WITH (NOWAIT) ON ic.[object_id] = c.[object_id] AND ic.column_id = c.column_id WHERE ic.[object_id] = tq.object_id ) c WHERE c.is_included_column = 1 AND c.index_id = i.index_id FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)''''''''), 1, 2, '''''''''''''''' ) + '''''''')'''''''', '''''''''''''''') + CHAR(13) FROM sys.indexes i WITH (NOWAIT) WHERE i.[object_id] = tq.object_id AND i.is_primary_key = 0 AND i.[type] = 2 FOR XML PATH(''''''''''''''''), TYPE ).value(''''''''.'''''''', ''''''''NVARCHAR(MAX)'''''''') ) , '''''''''''''''') AS SQL_DEF , tq.object_id FROM sys.tables tq) Q ON Q.object_id = tt.object_id WHERE tt.name LIKE ''''''''%'''''''''' + @objname + ''''''''''%'''''''' ) TUQ ) T1 '''') SELECT [Type], [Name], TRIM(CHAR(13) + CHAR(10) + '''' '''' FROM [Definition]) As Definition, ISNULL(TRY_CONVERT(xml, CASE WHEN TRY_CONVERT(xml, [Definition]) IS NULL THEN TRY_CONVERT(xml, REPLACE(REPLACE(REPLACE(TRIM([Definition]), CHAR(39), ''''''''), CHAR(60), ''''''''), CHAR(62), '''''''')) ELSE TRY_CONVERT(xml, [Definition]) END), ''''EXEC sp_helptext '''' + [name]) As [ClickDefinition] FROM ##TMP_LOAD UNION ALL SELECT ''''XML Schema Collection'''' As [Type], ''''['''' + s1.name + ''''].['''' + SXSC.name + '''']'''' As [Name], ''''CREATE XML SCHEMA COLLECTION ['''' + s1.name + ''''].['''' + SXSC.name + ''''] As '''' As [Definition], xml_schema_namespace(s1.name, sxsc.name) As [ClickDefinition] FROM sys.xml_schema_collections SXSC WITH (NOWAIT) JOIN sys.schemas s1 WITH (NOWAIT) ON s1.schema_id = sxsc.schema_id WHERE s1.name <> sxsc.name AND sxsc.name LIKE ''''%'' + @StrNorm + ''%'''' ORDER BY [Type];'') IF OBJECT_ID(''tempdb.dbo.##TMP_LOAD'') IS NOT NULL DROP TABLE ##TMP_LOAD; END TRY BEGIN CATCH PRINT ''Error trying to execute SQL: '' + CAST( ERROR_NUMBER() AS NVARCHAR(MAX) ) + '', '' + CAST( ERROR_MESSAGE() AS NVARCHAR(MAX)) PRINT ''--------------------------------------'' IF OBJECT_ID(''tempdb.dbo.##TMP_LOAD'') IS NOT NULL DROP TABLE ##TMP_LOAD; END CATCH END' ,N'@objname nvarchar(1000)', @objname = 
```
<Image>
 
Keybinding: Ctrl + 7
Description: A query plan checker based on the highlighted object. It checks through all objects that has the text highlightened through all the cached execution plans that are currently available.
Function: Easy and quick to use to find indexes needed based on a particularly slow table etc. It gives out information about which querys takes the longest aswell as each query within scripts and stored procedures etc. As long as it's within the cache.
Steps: Highlight a whole object, press Ctrl + 7 and the script will give out a lot of information that has a query plan with that particular highlight in it and show the heaviest latest queries.
Code:
```
 EXEC sp_executesql N'DECLARE @SQLQUERY NVARCHAR(MAX) = N''; DECLARE @IN_VARIABLE NVARCHAR(250) = NULL; IF LEN(''''@objname'''') > 0 BEGIN SET @IN_VARIABLE = '''''' + @objname + ''''''; END SELECT ISNULL(T1.ObjName, ''''User Session'''') As ObjName,ISNULL(T1.dbName, ''''DB Undetermined'''')	As dbName, T1.execution_count As ExecutionCount, CASE WHEN TRY_CONVERT(xml, T1.OriginExecution) IS NULL THEN TRY_CONVERT(xml, REPLACE(REPLACE(REPLACE(TRIM(T1.OriginExecution), CHAR(39), ''''''''), CHAR(60), ''''''''), CHAR(62), '''''''')) ELSE TRY_CONVERT(xml, T1.OriginExecution) END As OriginExecution, T1.query_plan As QueryPlan, CASE WHEN TRY_CONVERT(xml, T1.HeavyQuery) IS NULL THEN TRY_CONVERT(xml, REPLACE(REPLACE(REPLACE(TRIM(T1.HeavyQuery), CHAR(39), ''''''''), CHAR(60), ''''''''), CHAR(62), '''''''')) ELSE TRY_CONVERT(xml, T1.HeavyQuery) END As HeavyQuery, total_logical_reads, last_logical_reads, total_logical_writes, last_logical_writes, total_worker_time, last_worker_time, total_elapsed_time_in_S, last_elapsed_time_in_S, last_execution_time FROM ( SELECT OBJECT_NAME(ISNULL(sqltext.objectid, queryplan.objectid)) As ObjName, DB_NAME(ISNULL(sqltext.dbid, queryplan.dbid)) As DbName, Text As OriginExecution, query_plan, SUBSTRING(sqltext.TEXT, (T.statement_start_offset/2)+1,((CASE T.statement_end_offset WHEN -1 THEN DATALENGTH(sqltext.TEXT) ELSE T.statement_end_offset END - T.statement_start_offset)/2)+1) as HeavyQuery, T.* FROM (SELECT Q1.plan_handle, Q1.sql_handle, execution_count, Q1.statement_start_offset, Q1.statement_end_offset, Q1.total_logical_reads, Q1.last_logical_reads, Q1.total_logical_writes, Q1.last_logical_writes, Q1.total_worker_time, Q1.last_worker_time, Q1.total_elapsed_time/1000000 total_elapsed_time_in_S, Q1.last_elapsed_time/1000000 last_elapsed_time_in_S, Q1.last_execution_time FROM sys.dm_exec_query_stats Q1 JOIN sys.dm_exec_cached_plans Q2 ON Q1.plan_handle = Q2.plan_handle JOIN (SELECT Z1.plan_handle, Z1.sql_handle, last_execution_time, MAX(Z1.total_worker_time) AS total_worker_time FROM sys.dm_exec_query_stats Z1 JOIN sys.dm_exec_cached_plans Z2 ON Z1.plan_handle = Z2.plan_handle WHERE Z1.statement_sql_handle IS NOT NULL AND Z1.total_rows > 0 GROUP BY Z1.plan_handle, Z1.sql_handle, last_execution_time) T	ON T.plan_handle = Q1.plan_handle AND T.sql_handle  = Q1.sql_handle AND T.last_execution_time = Q1.last_execution_time AND T.total_worker_time = Q1.total_worker_time GROUP BY Q1.plan_handle, Q1.sql_handle, execution_count, Q1.statement_start_offset, Q1.statement_end_offset, Q1.total_logical_reads, Q1.last_logical_reads, Q1.total_logical_writes, Q1.last_logical_writes, Q1.total_worker_time, Q1.last_worker_time, Q1.total_elapsed_time/1000000, Q1.last_elapsed_time/1000000,Q1.last_execution_time) T CROSS APPLY sys.dm_exec_sql_text(T.sql_handle) sqltext CROSS APPLY sys.dm_exec_query_plan(T.plan_handle) queryplan WHERE sqltext.text IS NOT NULL AND 1 = CASE WHEN DB_NAME(ISNULL(sqltext.dbid, queryplan.dbid)) NOT IN (''''msdb'''', ''''master'''', ''''model'''') THEN 1 WHEN DB_NAME(ISNULL(sqltext.dbid, queryplan.dbid)) IS NULL THEN 1 ELSE 0 END) T1 WHERE 1 = CASE WHEN @IN_VARIABLE IS NULL THEN 1 WHEN T1.ObjName LIKE ''''%'''' + @IN_VARIABLE + ''''%'''' THEN 1 WHEN T1.OriginExecution LIKE ''''%'''' + @IN_VARIABLE + ''''%'''' THEN 1 WHEN T1.HeavyQuery LIKE ''''%'''' + @IN_VARIABLE + ''''%'''' THEN 1 ELSE 0 END ORDER BY last_execution_time desc;'' EXEC sp_executesql  @SQLQUERY ', N'@objname nvarchar(776) = NULL', @objname = 
 ```
<Image>
 
Keybinding: Ctrl + 8
Description: A quick view of how the databases are configured, along with information about the database files / backups etc.
Function: Easy to check when the last backup was made, how much data is being used, size of the databases etc. along with the files. This is a standalone script that I found and tweaked a little bit, but mostly credit of Prashanth Jayaram (link below to his page as well, it's a good read).
Steps: Don't have to highlight anything, can simply be used in any query window and pressing Ctrl + 8
Code:
```
 SELECT @@SERVERNAME Servername,CONVERT(VARCHAR(25), DBS.name) AS dbName,CONVERT(VARCHAR(10), DATABASEPROPERTYEX(name, 'status')) AS [Status],(SELECT COUNT(1) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid !=0 ) AS DataFiles,(SELECT SUM((CAST(size AS bigint)*8)/1024) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid!=0) AS [Data MB],(SELECT COUNT(1) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid=0) AS LogFiles,(SELECT SUM((CAST(size AS bigint)*8)/1024) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid=0) AS [Log MB],(SELECT SUM((CAST(size AS bigint)*8)/1024) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid!=0)+(SELECT SUM((CAST(size AS bigint)*8)/1024) FROM sys.sysaltfiles WHERE DB_NAME(dbid) = DBS.name AND groupid=0) TotalsizeMB,convert(sysname,DatabasePropertyEx(name,'Updateability')) DBUpdateability,convert(sysname,DatabasePropertyEx(name,'UserAccess')) DBUserAccess ,convert(sysname,DatabasePropertyEx(name,'Recovery')) DBRecoveryModel ,convert(sysname,DatabasePropertyEx(name,'Version')) DBVersion ,CASE cmptlevel WHEN 60 THEN '60 (SQL Server 6.0)'WHEN 65 THEN '65 (SQL Server 6.5)'WHEN 70 THEN '70 (SQL Server 7.0)'WHEN 80 THEN '80 (SQL Server 2000)'WHEN 90 THEN '90 (SQL Server 2005)'WHEN 100 THEN '100 (SQL Server 2008)'WHEN 110 THEN '100 (SQL Server 2012)'WHEN 120 THEN '100 (SQL Server 2014)'WHEN 130 THEN '100 (SQL Server 2016)'END AS dbcompatibilitylevel,CONVERT(VARCHAR(20), crdate, 103) + ' ' + CONVERT(VARCHAR(20), crdate, 108) AS [Creation date],ISNULL((SELECT TOP 1CASE TYPE WHEN 'D' THEN 'Full' WHEN 'I' THEN 'Differential' WHEN 'L' THEN 'Transaction log' END + ' – ' +LTRIM(ISNULL(STR(ABS(DATEDIFF(DAY, GETDATE(),Backup_finish_date))) + ' days ago', 'NEVER')) + ' – ' +CONVERT(VARCHAR(20), backup_start_date, 103) + ' ' + CONVERT(VARCHAR(20), backup_start_date, 108) + ' – ' +CONVERT(VARCHAR(20), backup_finish_date, 103) + ' ' + CONVERT(VARCHAR(20), backup_finish_date, 108) +' (' + CAST(DATEDIFF(second, BKS.backup_start_date,BKS.backup_finish_date) AS VARCHAR(4)) + ' '+ 'seconds)'FROM msdb.dbo.backupset BKS WHERE BKS.database_name = DBS.name ORDER BY backup_set_id DESC),'-') AS [Last backup]FROM sys.sysdatabases DBS ORDER BY dbName, [Last backup] DESC, NAME;select db_name(database_id) as db_name,database_id,name,physical_name,state,state_desc,* from sys.master_files
```
<Image>
 
Keybinding: Ctrl + 9
Description: This shortcut is based on finding indexes with high fragmentation from the highlighted text. This should only be used on tables. It's runs fairly slow, but it’s a nice feature to use for index defragmentation.
Function: Shows the fragmentation of indexes. The rightmost column contains a suggested script that can be used to rebuild the index. If multiple instances of the same table name is used, it will list a setting for each schema for this table name.
Steps: Highlight the table name that you want to check and press Ctrl + 9, this can take a while depending on how large your database is.
Code:
```
 EXEC sp_executesql N'DECLARE @TABLE_NAME NVARCHAR(250) = @objname DECLARE @INDEX_SQL	NVARCHAR(MAX) = N''SELECT a.index_id, sch.name, tabl.name, b.name, avg_fragmentation_in_percent, fragment_count, avg_fragment_size_in_pages, ''''''''ALTER INDEX ['''''''' + b.[name] + ''''''''] ON ['''''''' + sch.[name] + ''''''''].['''''''' + tabl.[name] + ''''''''] '''''''' + CASE WHEN a.avg_fragmentation_in_percent > 30 THEN ''''''''REBUILD WITH (FILLFACTOR = 80)'''''''' ELSE ''''''''REORGANIZE'''''''' END + '''''''';'''''''' As IndexRebuild FROM sys.Dm_db_index_physical_stats(Db_id(), Object_id(''''''''?''''''''), NULL, NULL, NULL) AS a INNER JOIN sys.tables tabl on tabl.[object_id] = a.[object_id] INNER JOIN sys.schemas sch on tabl.[schema_id] = sch.[schema_id] INNER JOIN sys.indexes b ON a.object_id = b.object_id AND a.index_id = b.index_id WHERE b.[name] IS NOT NULL AND a.avg_fragmentation_in_percent > 5 AND tabl.Name = '''''''''' + @TABLE_NAME + '''''''''' ORDER BY a.avg_fragmentation_in_percent desc;''; IF (SELECT TOP(1) 1 FROM INFORMATION_SCHEMA.TABLES T WHERE T.TABLE_NAME = @TABLE_NAME) = 1 AND (SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES T WHERE T.TABLE_NAME = @TABLE_NAME) > 1 BEGIN IF OBJECT_ID(''tempdb..#INFORMATION_SCHEMA'') IS NOT NULL	DROP TABLE #INFORMATION_SCHEMA CREATE TABLE #INFORMATION_SCHEMA ([Tbl] [NVARCHAR](200) NOT NULL) INSERT INTO #INFORMATION_SCHEMA SELECT a.TABLE_SCHEMA + ''.'' + a.TABLE_NAME AS Tbl FROM INFORMATION_SCHEMA.COLUMNS a WHERE a.TABLE_NAME = @TABLE_NAME GROUP BY a.TABLE_SCHEMA, a.TABLE_NAME;DECLARE @COMMAND_1 NVARCHAR(MAX) = N''IF (SELECT 1 FROM #INFORMATION_SCHEMA WHERE Tbl = REPLACE(REPLACE(''''?'''', ''''['''', ''''''''), '''']'''', '''''''')) = 1 BEGIN BEGIN TRY EXEC('''''' + @INDEX_SQL + '''''') END TRY BEGIN CATCH SELECT ''''? Could not be bound for the latest schema'''' As Error END CATCH;END'' EXEC dbo.sp_MSforeachtable @command1 = @COMMAND_1 IF OBJECT_ID(''tempdb..#INFORMATION_SCHEMA'') IS NOT NULL	DROP TABLE #INFORMATION_SCHEMA END ELSE BEGIN DECLARE @SCHEMA NVARCHAR(255) = (SELECT TABLE_SCHEMA FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @TABLE_NAME) SET @INDEX_SQL = REPLACE(REPLACE(@INDEX_SQL, ''?'', @SCHEMA + ''.'' + @TABLE_NAME), CHAR(39) + CHAR(39), CHAR(39)) EXEC (@INDEX_SQL) END', N'@objname nvarchar(776)', @objname = 
 ```
<Image>
 
Keybinding: Ctrl + 0
Description: While working with multiple tables based on the same name between test / dev etc. it's nice to able to switch quickly between databases while running test scripts etc.
Function: Easy usage for switching between databases
Steps: Highight a database and press Ctrl + 0
Code:
```
 USE 
```
<Image>
 
By customizing key bindings to suit your unique needs and preferences, you can navigate SSMS with ease and efficiency, enhancing your overall productivity.
Share your favorite custom key bindings in SSMS in the comments below! I'm very interested in seeing what everyone else has found and come across! Let's exchange tips and tricks to empower each other in our SQL Server journey!

Lars Gustafsson

BI / Analytics / Hadoop / Cloudera Architect, partner at XLENT


@XLENT #wearexlent #analytics #SQLServer #SSMS #ProductivityTips #CustomKeybindings #DatabaseManagement #DataEngineer
Links and references.
https://www.sqlshack.com/custom-keyboard-shortcuts-in-sql-server-management-studio-ssms/ - Prashanth Jayaram

